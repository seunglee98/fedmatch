<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Chris Webster" />


<title>Multivar Matching</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Multivar Matching</h1>
<h4 class="author">Chris Webster</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(fedmatch)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code></pre></div>
<div id="background" class="section level1">
<h1>Background</h1>
<p>While name matching is covered well by the tools
in<code>fedmatch::merge_plus()</code> and
<code>fedmatch::fuzzy_match()</code>, sometimes it is useful to pull in
additional information besides names. These could include company
information fields like industry code, zip codes, countries, and the
like. Or, for loans, it could include loan amounts, origination dates,
or industry codes. Or, one could even want to use multiple different
names at the same time. This is where
<code>fedmatch::multivar_match()</code> comes into play. It lets you
compare two records based on multiple fields. It does so by assigning a
numeric value from 0-1 for each field, and then computing a weighted sum
(or predicts a probability with a logit model), arriving at a final
multivar_score for a given pair of records. It computes these
multivar_scores for every possible combination of records, and picks the
best match for each</p>
</div>
<div id="syntax" class="section level1">
<h1>Syntax</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;corp_data1&quot;</span>, <span class="at">package =</span> <span class="st">&quot;fedmatch&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;corp_data2&quot;</span>, <span class="at">package =</span> <span class="st">&quot;fedmatch&quot;</span>)</span></code></pre></div>
<p>The basic syntax is as follows, using the example company data in
fedmatch:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>corp_data1_test <span class="ot">&lt;-</span> <span class="fu">copy</span>(corp_data1)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(corp_data1_test)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>corp_data2_test <span class="ot">&lt;-</span> <span class="fu">copy</span>(corp_data2)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(corp_data2_test)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>corp_data1_test[, id_1 <span class="sc">:=</span> <span class="fu">seq</span>(<span class="dv">1</span>, .N)]</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>corp_data2_test[, id_2 <span class="sc">:=</span> <span class="fu">seq</span>(<span class="dv">1</span>, .N)]</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>corp_data2_test[, Country <span class="sc">:=</span> country]</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>corp_data2_test[, Company <span class="sc">:=</span> Name]</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">merge_plus</span>(</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="at">data1 =</span> corp_data1_test,</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="at">data2 =</span> corp_data2_test,</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="at">match_type =</span> <span class="st">&quot;multivar&quot;</span>,</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Company&quot;</span>),</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>   <span class="at">suffixes =</span> <span class="fu">c</span>(<span class="st">&quot;_1&quot;</span>, <span class="st">&quot;_2&quot;</span>),</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  <span class="at">unique_key_1 =</span> <span class="st">&quot;id_1&quot;</span>,</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  <span class="at">unique_key_2 =</span> <span class="st">&quot;id_2&quot;</span>, </span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>  <span class="at">multivar_settings =</span> <span class="fu">build_multivar_settings</span>(</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  <span class="at">compare_type =</span> <span class="fu">c</span>(<span class="st">&quot;indicator&quot;</span>, <span class="st">&quot;stringdist&quot;</span>),</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="at">wgts =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">nthread =</span> <span class="dv">1</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a> </span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>))</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>result</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">#&gt; $matches</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co">#&gt; Key: &lt;id_2&gt;</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt; Index: &lt;tier&gt;</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt;     unique_key_1          Company_1 Country_1  State   SIC Revenue  id_1</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">#&gt;            &lt;int&gt;             &lt;char&gt;    &lt;char&gt; &lt;char&gt; &lt;num&gt;   &lt;num&gt; &lt;int&gt;</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt;  1:            1            Walmart       USA     OH  3300     485     1</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">#&gt;  2:            2   Bershire Hataway       USA         2222     223     2</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co">#&gt;  3:            3              Apple       USA     CA  3384     215     3</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co">#&gt;  4:            4       Exxon Mobile       USA     TX  2222     205     4</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="co">#&gt;  5:            5          McKesson    Germany     MA   222     192     5</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="co">#&gt;  6:            6 UnitedHealth Group       USA     MA    NA     184     6</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co">#&gt;  7:            7         CVS Health       USA     RI  1112     177     7</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="co">#&gt;  8:            9               AT&amp;T       USA     TN  4000     163     9</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co">#&gt;  9:            8     General Motors       USA     MI  2222     166     8</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="co">#&gt; 10:           10 Ford Motor Company       USA     MI    NA     151    10</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="co">#&gt;                   Name country state_code SIC_code earnings unique_key_2  id_2</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="co">#&gt;                 &lt;char&gt;  &lt;char&gt;     &lt;char&gt;    &lt;num&gt;   &lt;char&gt;        &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="co">#&gt;  1:            Walmart     USA         OH     3380  490,000            1     1</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="co">#&gt;  2:  Bershire Hathaway     USA         NE     2220  220,000            2     2</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="co">#&gt;  3:     Apple Computer     USA         CA       NA  220,000            3     3</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="co">#&gt;  4: Exxon Mobile Inc.      USA         TX     2222  210,000            4     4</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a><span class="co">#&gt;  5:     McKesson Corp.                 MA     2222  190,000            5     5</span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="co">#&gt;  6: UnitedHealth Group     USA         MA     1130  180,000            6     6</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="co">#&gt;  7: UnitedHealth Group     USA         MA     1130  180,000            6     6</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a><span class="co">#&gt;  8:             AT &amp; T     USA         TN     4000  160,000            9     9</span></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a><span class="co">#&gt;  9:         Ford Motor     USA         MI     2222  150,000           10    10</span></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a><span class="co">#&gt; 10:         Ford Motor     USA         MI     2222  150,000           10    10</span></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a><span class="co">#&gt;     Country_2          Company_2 Country_compare Company_compare multivar_score</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a><span class="co">#&gt;        &lt;char&gt;             &lt;char&gt;           &lt;num&gt;           &lt;num&gt;          &lt;num&gt;</span></span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a><span class="co">#&gt;  1:       USA            Walmart               1       1.0000000      1.0000000</span></span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a><span class="co">#&gt;  2:       USA  Bershire Hathaway               1       0.9882353      0.9941176</span></span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a><span class="co">#&gt;  3:       USA     Apple Computer               1       0.8714286      0.9357143</span></span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a><span class="co">#&gt;  4:       USA Exxon Mobile Inc.                1       0.9333333      0.9666667</span></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a><span class="co">#&gt;  5:               McKesson Corp.               0       0.9285714      0.4642857</span></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a><span class="co">#&gt;  6:       USA UnitedHealth Group               1       1.0000000      1.0000000</span></span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a><span class="co">#&gt;  7:       USA UnitedHealth Group               1       0.5333333      0.7666667</span></span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a><span class="co">#&gt;  8:       USA             AT &amp; T               1       0.9111111      0.9555556</span></span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a><span class="co">#&gt;  9:       USA         Ford Motor               1       0.7333333      0.8666667</span></span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a><span class="co">#&gt; 10:       USA         Ford Motor               1       0.9111111      0.9555556</span></span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a><span class="co">#&gt;       tier</span></span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt;</span></span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a><span class="co">#&gt;  1:    all</span></span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a><span class="co">#&gt;  2:    all</span></span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a><span class="co">#&gt;  3:    all</span></span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a><span class="co">#&gt;  4:    all</span></span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a><span class="co">#&gt;  5:    all</span></span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a><span class="co">#&gt;  6:    all</span></span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a><span class="co">#&gt;  7:    all</span></span>
<span id="cb3-73"><a href="#cb3-73" tabindex="-1"></a><span class="co">#&gt;  8:    all</span></span>
<span id="cb3-74"><a href="#cb3-74" tabindex="-1"></a><span class="co">#&gt;  9:    all</span></span>
<span id="cb3-75"><a href="#cb3-75" tabindex="-1"></a><span class="co">#&gt; 10:    all</span></span>
<span id="cb3-76"><a href="#cb3-76" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-77"><a href="#cb3-77" tabindex="-1"></a><span class="co">#&gt; $matches_filter</span></span>
<span id="cb3-78"><a href="#cb3-78" tabindex="-1"></a><span class="co">#&gt; Null data.table (0 rows and 0 cols)</span></span>
<span id="cb3-79"><a href="#cb3-79" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-80"><a href="#cb3-80" tabindex="-1"></a><span class="co">#&gt; $data1_nomatch</span></span>
<span id="cb3-81"><a href="#cb3-81" tabindex="-1"></a><span class="co">#&gt; Empty data.table (0 rows and 7 cols): Company,Country,State,SIC,Revenue,unique_key_1...</span></span>
<span id="cb3-82"><a href="#cb3-82" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-83"><a href="#cb3-83" tabindex="-1"></a><span class="co">#&gt; $data2_nomatch</span></span>
<span id="cb3-84"><a href="#cb3-84" tabindex="-1"></a><span class="co">#&gt;      Name country state_code SIC_code earnings unique_key_2  id_2 Country</span></span>
<span id="cb3-85"><a href="#cb3-85" tabindex="-1"></a><span class="co">#&gt;    &lt;char&gt;  &lt;char&gt;     &lt;char&gt;    &lt;num&gt;   &lt;char&gt;        &lt;int&gt; &lt;int&gt;  &lt;char&gt;</span></span>
<span id="cb3-86"><a href="#cb3-86" tabindex="-1"></a><span class="co">#&gt; 1:    CVS                 RI     1122  180,000            7     7        </span></span>
<span id="cb3-87"><a href="#cb3-87" tabindex="-1"></a><span class="co">#&gt; 2:     GM                 MI     2222  170,000            8     8        </span></span>
<span id="cb3-88"><a href="#cb3-88" tabindex="-1"></a><span class="co">#&gt;    Company</span></span>
<span id="cb3-89"><a href="#cb3-89" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt;</span></span>
<span id="cb3-90"><a href="#cb3-90" tabindex="-1"></a><span class="co">#&gt; 1:     CVS</span></span>
<span id="cb3-91"><a href="#cb3-91" tabindex="-1"></a><span class="co">#&gt; 2:      GM</span></span>
<span id="cb3-92"><a href="#cb3-92" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-93"><a href="#cb3-93" tabindex="-1"></a><span class="co">#&gt; $match_evaluation</span></span>
<span id="cb3-94"><a href="#cb3-94" tabindex="-1"></a><span class="co">#&gt; Index: &lt;tier&gt;</span></span>
<span id="cb3-95"><a href="#cb3-95" tabindex="-1"></a><span class="co">#&gt;      tier matches in_tier_unique_1 in_tier_unique_2 pct_matched_1 pct_matched_2</span></span>
<span id="cb3-96"><a href="#cb3-96" tabindex="-1"></a><span class="co">#&gt;    &lt;char&gt;   &lt;int&gt;            &lt;int&gt;            &lt;int&gt;         &lt;num&gt;         &lt;num&gt;</span></span>
<span id="cb3-97"><a href="#cb3-97" tabindex="-1"></a><span class="co">#&gt; 1:    all      10               10                8             1           0.8</span></span>
<span id="cb3-98"><a href="#cb3-98" tabindex="-1"></a><span class="co">#&gt;    new_unique_1 new_unique_2</span></span>
<span id="cb3-99"><a href="#cb3-99" tabindex="-1"></a><span class="co">#&gt;           &lt;int&gt;        &lt;int&gt;</span></span>
<span id="cb3-100"><a href="#cb3-100" tabindex="-1"></a><span class="co">#&gt; 1:           10            8</span></span></code></pre></div>
<p>Let’s go through the arguments:</p>
<ul>
<li>The first 7 arguments are identical to those in
<code>merge_plus</code>, except ‘by’ can contain multiple elements,
unlike with <code>merge_plus</code>.</li>
<li>‘compare_type’ is a character vector, equal to the length of the
‘by’ vector, that describes how to compare each field. The options are
“in”, “indicator”, “difference”, “ratio”, and “stringdist”. Each of the
comparison metrics are scaled such that they are also in between 0 and
1.
<ul>
<li>“indicator” is a binary indicator for if the two fields match
exactly.</li>
<li>“in” is a binary indicator for one string being within the other
(e.g. ‘abc corp’ and ‘abc’ would get a score of 1 )</li>
<li>“difference” computes the numeric difference between the two
columns, scaled by the largest difference in the dataset</li>
<li>“ratio” computes the ratio between the two columns, always such that
the ratio is less than 1</li>
<li>“stringdist” computes the Jaro-Winkler string distance between the
strings.</li>
<li>“wgt_jaccard_dist” computes the weighted jaccard distance between
the strings (see fuzzy matching vignette for details on how this is
computed.)</li>
</ul></li>
<li>‘wgts’ is a vector of weights, length equal to the length of the
‘by’ vector, that describes how to weight each field for computing a
multivar_score.</li>
<li>‘nthread’ is how many threads to use when making the comparisons,
see <code>parallel::makeCluster()</code></li>
<li>‘logit’ is a logit model (described in detail later) that can be
used instead of ‘wgts’ to combine the comparison scores into a final
multivar_score using <code>base::predict()</code></li>
</ul>
</div>
<div id="return-value" class="section level1">
<h1>Return value</h1>
<p><code>multivar_match</code> returns a data.table with the columns
from both <code>data_1</code> and <code>data_2</code>, just like
<code>base::merge()</code>. In addition, it returns three columns for
each variable in <code>by</code>: two for the original columns in the
data, and one column with the suffix ‘compare’ that has the numerical
value for the given comparison. For example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">print</span>(result<span class="sc">$</span>matches[, .(Company_1, Company_2, Company_compare)])</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt;              Company_1          Company_2 Company_compare</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt;                 &lt;char&gt;             &lt;char&gt;           &lt;num&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt;  1:            Walmart            Walmart       1.0000000</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt;  2:   Bershire Hataway  Bershire Hathaway       0.9882353</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt;  3:              Apple     Apple Computer       0.8714286</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt;  4:       Exxon Mobile Exxon Mobile Inc.        0.9333333</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;  5:          McKesson      McKesson Corp.       0.9285714</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt;  6: UnitedHealth Group UnitedHealth Group       1.0000000</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;  7:         CVS Health UnitedHealth Group       0.5333333</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt;  8:               AT&amp;T             AT &amp; T       0.9111111</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt;  9:     General Motors         Ford Motor       0.7333333</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; 10: Ford Motor Company         Ford Motor       0.9111111</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">print</span>(result<span class="sc">$</span>matches[, .(Country_1, Country_2, Country_compare)])</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt;     Country_1 Country_2 Country_compare</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt;        &lt;char&gt;    &lt;char&gt;           &lt;num&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt;  1:       USA       USA               1</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt;  2:       USA       USA               1</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt;  3:       USA       USA               1</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt;  4:       USA       USA               1</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt;  5:   Germany                         0</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt;  6:       USA       USA               1</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt;  7:       USA       USA               1</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt;  8:       USA       USA               1</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt;  9:       USA       USA               1</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; 10:       USA       USA               1</span></span></code></pre></div>
<p>Further, it adds one additional column for the overall
multivar_score. In our example, we set the weights each equal to 0.5, so
the multivar_score is simply the average of our two comparison
variables:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">print</span>(result<span class="sc">$</span>matches[, .(Company_compare, Country_compare, multivar_score)])</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt;     Company_compare Country_compare multivar_score</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt;               &lt;num&gt;           &lt;num&gt;          &lt;num&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt;  1:       1.0000000               1      1.0000000</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt;  2:       0.9882353               1      0.9941176</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;  3:       0.8714286               1      0.9357143</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt;  4:       0.9333333               1      0.9666667</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;  5:       0.9285714               0      0.4642857</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt;  6:       1.0000000               1      1.0000000</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt;  7:       0.5333333               1      0.7666667</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt;  8:       0.9111111               1      0.9555556</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt;  9:       0.7333333               1      0.8666667</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; 10:       0.9111111               1      0.9555556</span></span></code></pre></div>
</div>
<div id="calculating-weights-from-a-training-set" class="section level1">
<h1>Calculating weights from a training set</h1>
<p>If you’re not sure what the weights for each variable should be, you
can use the function <code>fedmatch::calculate_weights()</code> in
conjunction with a validated match set to get an estimate. This uses the
methodology from Felligi and Sunter’s seminal paper <em>A Theory for
Record Linkage</em>. You can find more information on the <a href="https://en.wikipedia.org/wiki/Record_linkage">Record Linkage
Wikipedia page</a>. Essentially, fedmatch looks for which variables are
most likely to match when two records match, and uses this criteria to
weight the variables. Here is an example of how this would work:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>fake_result_table <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="at">Company_1 =</span> <span class="fu">c</span>(<span class="st">&quot;ABC Corp&quot;</span>, <span class="st">&quot;XYZ Corporation&quot;</span>, <span class="st">&quot;Apple Corp&quot;</span>, <span class="st">&quot;Banana Corp&quot;</span>),</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="at">Company_2 =</span> <span class="fu">c</span>(<span class="st">&quot;ABC Corporation&quot;</span>, <span class="st">&quot;XYZ Inc&quot;</span>, <span class="st">&quot;Apple Incorporated&quot;</span>, <span class="st">&quot;Banana Stand&quot;</span>),</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="at">Country_1 =</span> <span class="fu">c</span>(<span class="st">&quot;USA&quot;</span>, <span class="st">&quot;USA&quot;</span>, <span class="st">&quot;TUR&quot;</span>, <span class="st">&quot;USA&quot;</span>),</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="at">Country_2 =</span> <span class="fu">c</span>(<span class="st">&quot;MEX&quot;</span>, <span class="st">&quot;USA&quot;</span>, <span class="st">&quot;TUR&quot;</span>, <span class="st">&quot;USA&quot;</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  )</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>calculated_weights <span class="ot">&lt;-</span> <span class="fu">calculate_weights</span>(fake_result_table, <span class="fu">c</span>(<span class="st">&quot;Company&quot;</span>, <span class="st">&quot;Country&quot;</span>),</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>                                        <span class="at">compare_type =</span> <span class="fu">c</span>(<span class="st">&quot;stringdist&quot;</span>, <span class="st">&quot;indicator&quot;</span>),</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>                                        <span class="at">suffixes =</span> <span class="fu">c</span>(<span class="st">&quot;_1&quot;</span>, <span class="st">&quot;_2&quot;</span>))</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>calculated_weights<span class="sc">$</span>w</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt;   Company   Country </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; 0.7349053 0.2650947</span></span></code></pre></div>
<p>In this dummy example, the names are giving us more information about
the match quality than the countries, and so the weights are
correspondingly higher. If you’d like more details on the exact
methodology, see the manual documentation for
<code>calculate_weights</code>.</p>
</div>
<div id="using-a-logit-model-instead-of-a-linear-sum" class="section level1">
<h1>Using a logit model instead of a linear sum</h1>
<p>Rather than using a linear combination of the comparison variables,
we can instead train a logit model on a training set of matches and
non-matches. The explanatory variables are each of the comparison
variables, and the dependent variable is a binary 1/0 for if the two
records are a match or not. This data set needs to be constructed by
hand, and is similar to the type of data set used with
<code>calculate_weights.</code> However, it must contain both matches
and non-matches for the logit model to be well-trained. Here is an
example of how this would look:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>corp_data1_test <span class="ot">&lt;-</span> <span class="fu">copy</span>(corp_data1)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(corp_data1_test)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>corp_data2_test <span class="ot">&lt;-</span> <span class="fu">copy</span>(corp_data2)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(corp_data2_test)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>corp_data1_test[, id_1 <span class="sc">:=</span> <span class="fu">seq</span>(<span class="dv">1</span>, .N)]</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>corp_data2_test[, id_2 <span class="sc">:=</span> <span class="fu">seq</span>(<span class="dv">1</span>, .N)]</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>corp_data2_test[, Country <span class="sc">:=</span> country]</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>corp_data2_test[, Company <span class="sc">:=</span> Name]</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111</span>)</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>fake_result_table <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>  <span class="at">match =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="fl">1e5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>  <span class="at">Company_compare =</span> <span class="fu">runif</span>(<span class="fl">1e5</span>),</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  <span class="at">Country_compare =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="fl">1e5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>)</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>logit_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(match <span class="sc">~</span> Company_compare <span class="sc">+</span> Country_compare,</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>  <span class="at">data =</span> fake_result_table</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>)</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="fu">summary</span>(logit_model)</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co">#&gt; glm(formula = match ~ Company_compare + Country_compare, family = &quot;binomial&quot;, </span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">#&gt;     data = fake_result_table)</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="co">#&gt;                 Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="co">#&gt; (Intercept)      0.69243    0.01502  46.097   &lt;2e-16 ***</span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="co">#&gt; Company_compare -0.02710    0.02324  -1.166   0.2436    </span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a><span class="co">#&gt; Country_compare  0.03155    0.01342   2.351   0.0187 *  </span></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 127258  on 99999  degrees of freedom</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 127251  on 99997  degrees of freedom</span></span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a><span class="co">#&gt; AIC: 127257</span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">merge_plus</span>(corp_data1_test, corp_data2_test,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                     <span class="at">match_type =</span> <span class="st">&quot;multivar&quot;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                     <span class="at">multivar_settings =</span> <span class="fu">build_multivar_settings</span>(<span class="at">logit =</span> logit_model, <span class="at">compare_type =</span> <span class="fu">c</span>(<span class="st">&quot;indicator&quot;</span>, <span class="st">&quot;stringdist&quot;</span>),</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="at">wgts =</span> <span class="cn">NULL</span>, <span class="at">nthread =</span> <span class="dv">1</span>),</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Company&quot;</span>), <span class="at">unique_key_1 =</span> <span class="st">&quot;id_1&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="at">unique_key_2 =</span> <span class="st">&quot;id_2&quot;</span>, </span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  <span class="at">suffixes =</span> <span class="fu">c</span>(<span class="st">&quot;_1&quot;</span>, <span class="st">&quot;_2&quot;</span>)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>result</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; $matches</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; Key: &lt;id_2&gt;</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; Index: &lt;tier&gt;</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt;     unique_key_1          Company_1 Country_1  State   SIC Revenue  id_1</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt;            &lt;int&gt;             &lt;char&gt;    &lt;char&gt; &lt;char&gt; &lt;num&gt;   &lt;num&gt; &lt;int&gt;</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt;  1:            4       Exxon Mobile       USA     TX  2222     205     4</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt;  2:            5          McKesson    Germany     MA   222     192     5</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt;  3:            6 UnitedHealth Group       USA     MA    NA     184     6</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt;  4:            9               AT&amp;T       USA     TN  4000     163     9</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt;  5:            2   Bershire Hataway       USA         2222     223     2</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt;  6:            7         CVS Health       USA     RI  1112     177     7</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">#&gt;  7:           10 Ford Motor Company       USA     MI    NA     151    10</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt;  8:            1            Walmart       USA     OH  3300     485     1</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co">#&gt;  9:            8     General Motors       USA     MI  2222     166     8</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co">#&gt; 10:            3              Apple       USA     CA  3384     215     3</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="co">#&gt;                   Name country state_code SIC_code earnings unique_key_2  id_2</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="co">#&gt;                 &lt;char&gt;  &lt;char&gt;     &lt;char&gt;    &lt;num&gt;   &lt;char&gt;        &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co">#&gt;  1:            Walmart     USA         OH     3380  490,000            1     1</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co">#&gt;  2:            Walmart     USA         OH     3380  490,000            1     1</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co">#&gt;  3:            Walmart     USA         OH     3380  490,000            1     1</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#&gt;  4:            Walmart     USA         OH     3380  490,000            1     1</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="co">#&gt;  5: Exxon Mobile Inc.      USA         TX     2222  210,000            4     4</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co">#&gt;  6: Exxon Mobile Inc.      USA         TX     2222  210,000            4     4</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="co">#&gt;  7: UnitedHealth Group     USA         MA     1130  180,000            6     6</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co">#&gt;  8:             AT &amp; T     USA         TN     4000  160,000            9     9</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="co">#&gt;  9:             AT &amp; T     USA         TN     4000  160,000            9     9</span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a><span class="co">#&gt; 10:         Ford Motor     USA         MI     2222  150,000           10    10</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a><span class="co">#&gt;     Country_2          Company_2 Country_compare Company_compare multivar_score</span></span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a><span class="co">#&gt;        &lt;char&gt;             &lt;char&gt;           &lt;num&gt;           &lt;num&gt;          &lt;num&gt;</span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a><span class="co">#&gt;  1:       USA            Walmart               1       0.0000000      0.6734819</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a><span class="co">#&gt;  2:       USA            Walmart               0       0.0000000      0.6665064</span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a><span class="co">#&gt;  3:       USA            Walmart               1       0.3650794      0.6713026</span></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a><span class="co">#&gt;  4:       USA            Walmart               1       0.0000000      0.6734819</span></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a><span class="co">#&gt;  5:       USA Exxon Mobile Inc.                1       0.2847222      0.6717829</span></span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a><span class="co">#&gt;  6:       USA Exxon Mobile Inc.                1       0.3777778      0.6712266</span></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a><span class="co">#&gt;  7:       USA UnitedHealth Group               1       0.4497354      0.6707962</span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a><span class="co">#&gt;  8:       USA             AT &amp; T               1       0.0000000      0.6734819</span></span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a><span class="co">#&gt;  9:       USA             AT &amp; T               1       0.4126984      0.6710178</span></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a><span class="co">#&gt; 10:       USA         Ford Motor               1       0.0000000      0.6734819</span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a><span class="co">#&gt;       tier</span></span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt;</span></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a><span class="co">#&gt;  1:    all</span></span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a><span class="co">#&gt;  2:    all</span></span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a><span class="co">#&gt;  3:    all</span></span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a><span class="co">#&gt;  4:    all</span></span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a><span class="co">#&gt;  5:    all</span></span>
<span id="cb9-57"><a href="#cb9-57" tabindex="-1"></a><span class="co">#&gt;  6:    all</span></span>
<span id="cb9-58"><a href="#cb9-58" tabindex="-1"></a><span class="co">#&gt;  7:    all</span></span>
<span id="cb9-59"><a href="#cb9-59" tabindex="-1"></a><span class="co">#&gt;  8:    all</span></span>
<span id="cb9-60"><a href="#cb9-60" tabindex="-1"></a><span class="co">#&gt;  9:    all</span></span>
<span id="cb9-61"><a href="#cb9-61" tabindex="-1"></a><span class="co">#&gt; 10:    all</span></span>
<span id="cb9-62"><a href="#cb9-62" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-63"><a href="#cb9-63" tabindex="-1"></a><span class="co">#&gt; $matches_filter</span></span>
<span id="cb9-64"><a href="#cb9-64" tabindex="-1"></a><span class="co">#&gt; Null data.table (0 rows and 0 cols)</span></span>
<span id="cb9-65"><a href="#cb9-65" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-66"><a href="#cb9-66" tabindex="-1"></a><span class="co">#&gt; $data1_nomatch</span></span>
<span id="cb9-67"><a href="#cb9-67" tabindex="-1"></a><span class="co">#&gt; Empty data.table (0 rows and 7 cols): Company,Country,State,SIC,Revenue,unique_key_1...</span></span>
<span id="cb9-68"><a href="#cb9-68" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-69"><a href="#cb9-69" tabindex="-1"></a><span class="co">#&gt; $data2_nomatch</span></span>
<span id="cb9-70"><a href="#cb9-70" tabindex="-1"></a><span class="co">#&gt;                 Name country state_code SIC_code earnings unique_key_2  id_2</span></span>
<span id="cb9-71"><a href="#cb9-71" tabindex="-1"></a><span class="co">#&gt;               &lt;char&gt;  &lt;char&gt;     &lt;char&gt;    &lt;num&gt;   &lt;char&gt;        &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb9-72"><a href="#cb9-72" tabindex="-1"></a><span class="co">#&gt; 1: Bershire Hathaway     USA         NE     2220  220,000            2     2</span></span>
<span id="cb9-73"><a href="#cb9-73" tabindex="-1"></a><span class="co">#&gt; 2:    Apple Computer     USA         CA       NA  220,000            3     3</span></span>
<span id="cb9-74"><a href="#cb9-74" tabindex="-1"></a><span class="co">#&gt; 3:    McKesson Corp.                 MA     2222  190,000            5     5</span></span>
<span id="cb9-75"><a href="#cb9-75" tabindex="-1"></a><span class="co">#&gt; 4:               CVS                 RI     1122  180,000            7     7</span></span>
<span id="cb9-76"><a href="#cb9-76" tabindex="-1"></a><span class="co">#&gt; 5:                GM                 MI     2222  170,000            8     8</span></span>
<span id="cb9-77"><a href="#cb9-77" tabindex="-1"></a><span class="co">#&gt;    Country           Company</span></span>
<span id="cb9-78"><a href="#cb9-78" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt;            &lt;char&gt;</span></span>
<span id="cb9-79"><a href="#cb9-79" tabindex="-1"></a><span class="co">#&gt; 1:     USA Bershire Hathaway</span></span>
<span id="cb9-80"><a href="#cb9-80" tabindex="-1"></a><span class="co">#&gt; 2:     USA    Apple Computer</span></span>
<span id="cb9-81"><a href="#cb9-81" tabindex="-1"></a><span class="co">#&gt; 3:            McKesson Corp.</span></span>
<span id="cb9-82"><a href="#cb9-82" tabindex="-1"></a><span class="co">#&gt; 4:                       CVS</span></span>
<span id="cb9-83"><a href="#cb9-83" tabindex="-1"></a><span class="co">#&gt; 5:                        GM</span></span>
<span id="cb9-84"><a href="#cb9-84" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-85"><a href="#cb9-85" tabindex="-1"></a><span class="co">#&gt; $match_evaluation</span></span>
<span id="cb9-86"><a href="#cb9-86" tabindex="-1"></a><span class="co">#&gt; Index: &lt;tier&gt;</span></span>
<span id="cb9-87"><a href="#cb9-87" tabindex="-1"></a><span class="co">#&gt;      tier matches in_tier_unique_1 in_tier_unique_2 pct_matched_1 pct_matched_2</span></span>
<span id="cb9-88"><a href="#cb9-88" tabindex="-1"></a><span class="co">#&gt;    &lt;char&gt;   &lt;int&gt;            &lt;int&gt;            &lt;int&gt;         &lt;num&gt;         &lt;num&gt;</span></span>
<span id="cb9-89"><a href="#cb9-89" tabindex="-1"></a><span class="co">#&gt; 1:    all      10               10                5             1           0.5</span></span>
<span id="cb9-90"><a href="#cb9-90" tabindex="-1"></a><span class="co">#&gt;    new_unique_1 new_unique_2</span></span>
<span id="cb9-91"><a href="#cb9-91" tabindex="-1"></a><span class="co">#&gt;           &lt;int&gt;        &lt;int&gt;</span></span>
<span id="cb9-92"><a href="#cb9-92" tabindex="-1"></a><span class="co">#&gt; 1:           10            5</span></span></code></pre></div>
<p>Instead of using a weighted sum of comparison scores, we use
<code>base::predict</code> to arrive at a multivar_score that can be
interpreted as a match probability. A word of caution: the logit
parameters can give very non-intuitive results for the resultant
multivar_scores, because the <a href="https://en.wikipedia.org/wiki/Logit">logit function</a> is of
course non-linear. For example, in one project we were working on, there
was a coefficient of 40 and a coefficient of 3. However, if the variable
with the coefficient of ‘3’ had a comparison score of 0, then the
highest the multivar_score could be was only around 0.6! This was very
un-intuitive for us, and shows the complex nature of the logit
model.</p>
<p>All that said, the logit model has the benefit of returning an
easily-interpretable multivar_score: with a large enough (and clean
enough) training set, the fitted multivar_score is simply the
probability of a match. This is contrast to the multivar_scores returned
by the linear combination: these numbers have no immediate meaning, and
can vary dramatically for each project. In one project, a score of .6
might be very good, and in another, very bad. It is a good idea to try
both the logit and linear methods and play around with each for your
individual project.</p>
</div>
<div id="parallelization-and-saving-time" class="section level1">
<h1>Parallelization and saving time</h1>
<p>Because this method of matching relies on comparing each row of a
data set to each other row of a dataset, the time needed to perform a
match grows very quickly as the size of each data set increases. There
are several ways to help with this:</p>
<ol style="list-style-type: decimal">
<li>Cut down on the number of comparisons that need to be done by
grouping on one or more variables (say, countries) and only making
comparisons within those groups, or</li>
<li>Use many cores to split the work up and run the comparisons in
parallel.</li>
</ol>
<p>Here’s how the blocking works:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>corp_data1_test <span class="ot">&lt;-</span> <span class="fu">copy</span>(corp_data1)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(corp_data1_test)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>corp_data2_test <span class="ot">&lt;-</span> <span class="fu">copy</span>(corp_data2)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(corp_data2_test)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>corp_data1_test[, id_1 <span class="sc">:=</span> <span class="fu">seq</span>(<span class="dv">1</span>, .N)]</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>corp_data2_test[, id_2 <span class="sc">:=</span> <span class="fu">seq</span>(<span class="dv">1</span>, .N)]</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>corp_data2_test[, Country <span class="sc">:=</span> country]</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>corp_data2_test[, Company <span class="sc">:=</span> Name]</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">merge_plus</span>(</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>  <span class="at">data1 =</span> corp_data1_test,</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>  <span class="at">data2 =</span> corp_data2_test,</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>  <span class="at">match_type =</span> <span class="st">&quot;multivar&quot;</span>,</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Company&quot;</span>),</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>   <span class="at">suffixes =</span> <span class="fu">c</span>(<span class="st">&quot;_1&quot;</span>, <span class="st">&quot;_2&quot;</span>),</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>  <span class="at">unique_key_1 =</span> <span class="st">&quot;id_1&quot;</span>,</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>  <span class="at">unique_key_2 =</span> <span class="st">&quot;id_2&quot;</span>, </span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>  <span class="at">multivar_settings =</span> <span class="fu">build_multivar_settings</span>(</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>  <span class="at">compare_type =</span> <span class="fu">c</span>( <span class="st">&quot;stringdist&quot;</span>),</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>  <span class="at">wgts =</span> <span class="fu">c</span>(<span class="dv">1</span>), <span class="at">nthread =</span> <span class="dv">1</span>, <span class="at">blocks =</span> <span class="st">&quot;Country&quot;</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a> </span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>))</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>result<span class="sc">$</span>matches</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co">#&gt; Key: &lt;id_2&gt;</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="co">#&gt; Index: &lt;tier&gt;</span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="co">#&gt;    unique_key_1 Country          Company_1  State   SIC Revenue  id_1</span></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a><span class="co">#&gt;           &lt;int&gt;  &lt;char&gt;             &lt;char&gt; &lt;char&gt; &lt;num&gt;   &lt;num&gt; &lt;int&gt;</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a><span class="co">#&gt; 1:            1     USA            Walmart     OH  3300     485     1</span></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a><span class="co">#&gt; 2:            2     USA   Bershire Hataway         2222     223     2</span></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a><span class="co">#&gt; 3:            3     USA              Apple     CA  3384     215     3</span></span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a><span class="co">#&gt; 4:            4     USA       Exxon Mobile     TX  2222     205     4</span></span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a><span class="co">#&gt; 5:            6     USA UnitedHealth Group     MA    NA     184     6</span></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a><span class="co">#&gt; 6:            7     USA         CVS Health     RI  1112     177     7</span></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a><span class="co">#&gt; 7:            9     USA               AT&amp;T     TN  4000     163     9</span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a><span class="co">#&gt; 8:            8     USA     General Motors     MI  2222     166     8</span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a><span class="co">#&gt; 9:           10     USA Ford Motor Company     MI    NA     151    10</span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a><span class="co">#&gt;                  Name country state_code SIC_code earnings unique_key_2  id_2</span></span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a><span class="co">#&gt;                &lt;char&gt;  &lt;char&gt;     &lt;char&gt;    &lt;num&gt;   &lt;char&gt;        &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a><span class="co">#&gt; 1:            Walmart     USA         OH     3380  490,000            1     1</span></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a><span class="co">#&gt; 2:  Bershire Hathaway     USA         NE     2220  220,000            2     2</span></span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a><span class="co">#&gt; 3:     Apple Computer     USA         CA       NA  220,000            3     3</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a><span class="co">#&gt; 4: Exxon Mobile Inc.      USA         TX     2222  210,000            4     4</span></span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a><span class="co">#&gt; 5: UnitedHealth Group     USA         MA     1130  180,000            6     6</span></span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a><span class="co">#&gt; 6: UnitedHealth Group     USA         MA     1130  180,000            6     6</span></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a><span class="co">#&gt; 7:             AT &amp; T     USA         TN     4000  160,000            9     9</span></span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a><span class="co">#&gt; 8:         Ford Motor     USA         MI     2222  150,000           10    10</span></span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a><span class="co">#&gt; 9:         Ford Motor     USA         MI     2222  150,000           10    10</span></span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a><span class="co">#&gt;             Company_2 Company_compare multivar_score   tier</span></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a><span class="co">#&gt;                &lt;char&gt;           &lt;num&gt;          &lt;num&gt; &lt;char&gt;</span></span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a><span class="co">#&gt; 1:            Walmart       1.0000000      1.0000000    all</span></span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a><span class="co">#&gt; 2:  Bershire Hathaway       0.9882353      0.9882353    all</span></span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a><span class="co">#&gt; 3:     Apple Computer       0.8714286      0.8714286    all</span></span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a><span class="co">#&gt; 4: Exxon Mobile Inc.        0.9333333      0.9333333    all</span></span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a><span class="co">#&gt; 5: UnitedHealth Group       1.0000000      1.0000000    all</span></span>
<span id="cb10-55"><a href="#cb10-55" tabindex="-1"></a><span class="co">#&gt; 6: UnitedHealth Group       0.5333333      0.5333333    all</span></span>
<span id="cb10-56"><a href="#cb10-56" tabindex="-1"></a><span class="co">#&gt; 7:             AT &amp; T       0.9111111      0.9111111    all</span></span>
<span id="cb10-57"><a href="#cb10-57" tabindex="-1"></a><span class="co">#&gt; 8:         Ford Motor       0.7333333      0.7333333    all</span></span>
<span id="cb10-58"><a href="#cb10-58" tabindex="-1"></a><span class="co">#&gt; 9:         Ford Motor       0.9111111      0.9111111    all</span></span></code></pre></div>
<p>For our dummy example data, this isn’t that useful (we just drop one
observation with the Country being Germany). But, if there is a field in
the data that is well-populated and trusted, it can be used to
dramatically cut down on the number of observations.</p>
<p>Parallelization is implemented with the <code>nthread</code> argument
and <code>parallel::parLapply()</code>. The data is split into groups
equal to <code>nthread</code>, and then each core does its comparison,
all at the same time. This of course can dramatically speed up the
process, but requires more memory and computing power. For details on
the parallel process, see <code>parallel::parLapply</code> and
<code>parallel::makeCluster</code>.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
